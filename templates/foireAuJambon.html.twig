{% extends "base.html.twig" %}

{% block content %}
<div class="h-full">
    <div class="gap-2 p-2 grid grid-cols-12 items-center">
        <h1 class="col-span-12 text-center font-bold text-4xl p-2">Foire au jambon</h1>

        <!-- colonne de gauche -->
        <div class="grid grid-cols-12 gap-2 w-full col-span-12 lg:col-span-8">
            <div id="carousel1" class="relative overflow-hidden col-span-12 lg:col-span-6">
                <div id="carousel" class="carousel flex transition-transform duration-500 ease-out p-2">
                    <div class="slide flex-shrink-0">
                        <img src="../asset/AvB_logo.png" 
                            class="w-full h-auto max-w-full max-h-full object-contain mx-auto border-2 border-black">
                    </div>
                </div>
                <button id="prev1" 
                    class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-gray-200 text-white p-2 rounded-full z-10">
                    &lt;
                </button>
                <button id="next1" 
                    class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-gray-200 text-white p-2 rounded-full z-10">
                    &gt;
                </button>
            </div>

            <div class="grid grid-cols-12 gap-1 bg-white text-black p-4 w-full border-2 border-black col-span-12 lg:col-span-8">
                <label class="col-span-12 text-black text-center">Du 04 au 07 Avril 2024</label>
                <label class="col-span-12 lg:col-span-6 lg:col-start-7 text-center">Esplanade Roland Barthes, Bayonne, 64100</label>
            </div>
        </div>

        <!-- colonne de droite -->
        <div class="grid grid-cols-12 gap-2 col-span-12 lg:col-span-4">
            <div class="bg-[#A23145] text-white p-4 col-span-12">
                <h1 class="text-black p-2 font-bold text-4xl">Mais qu'est-ce que la Foire au Jambon ?</h1>
                <label class="text-white p-2">Bienvenue à la célèbre Foire au Jambon de Bayonne ! Depuis des siècles...</label>
                <h1 class="text-black p-2 font-bold text-2xl">Depuis quand ?</h1>
                <label class="text-white p-2">La Foire au Jambon de Bayonne existe depuis plus de 550 ans...</label>
                <h1 class="text-black p-2 font-bold text-2xl">Pour qui ?</h1>
                <label class="text-white p-2">Que vous soyez un visiteur ou un local aguerri...</label>
            </div>
        </div>
    </div>

    <!-- Section Commentaires -->
    <div class="mt-8 p-4 bg-[#f4f4f4] rounded-lg shadow-md">
        <h2 class="text-2xl font-bold text-[#A23145] mb-4">Commentaires</h2>

        <!-- Liste dynamique des commentaires -->
        <div id="comments-container" class="mb-6">
            <!-- Les commentaires seront injectés ici via JavaScript -->
        </div>

        <!-- Formulaire pour ajouter un commentaire -->
        <form id="comment-form" class="mt-6">
            <input type="text" id="author" name="author" placeholder="Votre nom" 
                class="w-full p-3 border-2 border-[#A23145] rounded-lg text-gray-700 mb-4" required>
            <textarea id="comment" name="comment" rows="3" 
                class="w-full p-3 border-2 border-[#A23145] rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-[#A23145]" required></textarea>
            <button type="submit" 
                class="mt-4 px-6 py-2 bg-[#A23145] text-white font-semibold rounded-lg hover:bg-[#8a1e36]">
                Envoyer
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    // Charger les commentaires au chargement de la page
    document.addEventListener("DOMContentLoaded", function () {
        fetchComments();
    });

    // Gestion de l'envoi du formulaire via AJAX
    document.getElementById('comment-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const author = document.getElementById('author').value.trim();
        const comment = document.getElementById('comment').value.trim();

        if (author && comment) {
            fetch('{{ path("ajouter_un_commentaire") }}', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ author, comment })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('comment-form').reset();
                    fetchComments(); // Recharger les commentaires après ajout
                } else {
                    alert(data.message || 'Erreur lors de l’ajout du commentaire.');
                }
            })
            .catch(error => console.error('Erreur :', error));
        } else {
            alert('Veuillez remplir tous les champs.');
        }
    });

    // Fonction pour récupérer et afficher les commentaires
    function fetchComments() {
        fetch('{{ path("gerer_commentaire") }}')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('comments-container');
                container.innerHTML = ''; // Réinitialise la zone des commentaires

                data.comments.forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.classList.add('mb-4');
                    commentDiv.innerHTML = `
                        <p class="font-semibold text-[#A23145]">${comment.author} :</p>
                        <p class="text-gray-700">${comment.text}</p>
                        <small class="text-gray-500">${new Date(comment.created_at).toLocaleString()}</small>
                    `;
                    container.appendChild(commentDiv);
                });
            })
            .catch(error => console.error('Erreur :', error));
    }
</script>
<script src="../js/caroussel.js"></script>
{% endblock %}
